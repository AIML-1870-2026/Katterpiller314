<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RGB Color Studio</title>
  <style>
    :root {
      --bg: #0d0d0d;
      --surface: #181818;
      --surface2: #222;
      --border: #2e2e2e;
      --text: #e0e0e0;
      --muted: #777;
      --radius: 10px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', system-ui, sans-serif;
      min-height: 100vh;
      padding: 2rem 1.5rem 4rem;
    }

    header {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    header h1 {
      font-size: 1.6rem;
      font-weight: 300;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: var(--text);
    }

    header p {
      color: var(--muted);
      font-size: 0.8rem;
      margin-top: 0.4rem;
      letter-spacing: 0.08em;
    }

    .layout {
      max-width: 960px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    /* ── Canvas Mixer ── */
    .canvas-mixer {
      background: #1a140a;
      border: 4px solid #2e2010;
      border-radius: 10px;
      padding: 10px;
      box-shadow: inset 0 0 28px rgba(0,0,0,0.65), 0 6px 24px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
    }

    #paint-canvas {
      display: block;
      width: 100%;
      border-radius: 4px;
      cursor: crosshair;
      touch-action: none;
    }

    .canvas-controls {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.65rem 0.25rem 0.2rem;
    }

    .brush-indicator {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.15);
      background: #ffffff;
      transition: background 0.08s;
      flex-shrink: 0;
    }

    .brush-size-wrap {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .canvas-label {
      font-size: 0.7rem;
      color: #8a7a5a;
      font-family: monospace;
      flex-shrink: 0;
    }

    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 3px;
      outline: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid #555;
      cursor: pointer;
    }

    .canvas-btn {
      background: #2a1f0f;
      border: 1px solid #5a4020;
      color: #a08050;
      border-radius: 6px;
      padding: 0.35rem 0.85rem;
      font-size: 0.72rem;
      cursor: pointer;
      transition: all 0.15s;
      flex-shrink: 0;
    }

    .canvas-btn:hover { background: #3a2a15; color: #c0a060; }

    #info-hex { cursor: pointer; transition: color 0.12s; }
    #info-hex:hover { color: #fff; }

    /* ── Info panel ── */
    .info-panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .panel-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--muted);
      margin-bottom: 0.6rem;
    }

    .val-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.6rem;
    }

    .val-box {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 7px;
      padding: 0.65rem;
      text-align: center;
    }

    .val-box .lbl {
      font-size: 0.65rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .val-box .num {
      font-size: 1.1rem;
      font-weight: 600;
      font-family: monospace;
      margin-top: 0.2rem;
    }

    /* ── Contrast checker ── */
    .contrast-section {
      grid-column: 1 / -1;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
    }

    .contrast-section h2 {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--muted);
      margin-bottom: 1rem;
    }

    .contrast-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .contrast-card {
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .contrast-demo {
      padding: 1rem 1.25rem;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .contrast-demo .demo-large {
      font-size: 1.4rem;
      font-weight: 700;
      line-height: 1.2;
    }

    .contrast-demo .demo-small {
      font-size: 0.85rem;
    }

    .contrast-info {
      background: var(--surface2);
      padding: 0.6rem 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .contrast-ratio {
      font-family: monospace;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .badge {
      font-size: 0.65rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
    }

    .badge.pass { background: #1a3d1a; color: #5fcf5f; }
    .badge.fail { background: #3d1a1a; color: #cf5f5f; }

    /* ── Palettes ── */
    .palettes {
      grid-column: 1 / -1;
    }

    .palettes > h2 {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--muted);
      margin-bottom: 1rem;
    }

    .palette-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .palette-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.25rem;
    }

    .palette-section h3 {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--muted);
      margin-bottom: 0.9rem;
    }

    .swatches {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0.5rem;
    }

    .swatch {
      aspect-ratio: 1;
      border-radius: 7px;
      cursor: pointer;
      border: 1px solid rgba(255,255,255,0.07);
      position: relative;
      transition: transform 0.12s, border-color 0.12s;
      overflow: hidden;
    }

    .swatch:hover {
      transform: scale(1.08);
      border-color: rgba(255,255,255,0.3);
    }

    .swatch-info {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.7);
      padding: 3px 4px;
      border-radius: 0 0 6px 6px;
      opacity: 0;
      transition: opacity 0.12s;
    }

    .swatch:hover .swatch-info { opacity: 1; }

    .swatch-hex {
      font-size: 0.55rem;
      font-family: monospace;
      color: #fff;
      display: block;
      text-align: center;
    }

    .swatch-badges {
      display: flex;
      justify-content: center;
      gap: 2px;
      margin-top: 2px;
    }

    .mini-badge {
      font-size: 0.45rem;
      font-weight: 700;
      padding: 1px 3px;
      border-radius: 2px;
    }

    .mini-badge.pass { background: #1a4a1a; color: #6fe06f; }
    .mini-badge.fail { background: rgba(200,60,60,0.5); color: #f88; }

    /* ── Toast ── */
    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(5rem);
      background: #2a2a2a;
      border: 1px solid #444;
      color: #e0e0e0;
      padding: 0.55rem 1.4rem;
      border-radius: 100px;
      font-size: 0.82rem;
      transition: transform 0.28s cubic-bezier(.34,1.56,.64,1);
      pointer-events: none;
      white-space: nowrap;
    }

    .toast.show { transform: translateX(-50%) translateY(0); }

    @media (max-width: 640px) {
      .layout { grid-template-columns: 1fr; }
      .contrast-section, .palettes, .paint-mixer { grid-column: 1; }
      .palette-grid { grid-template-columns: 1fr; }
      .contrast-grid { grid-template-columns: 1fr; }
    }

    /* ── Paint Brush Mixer ── */
    .paint-mixer {
      grid-column: 1 / -1;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
    }

    .paint-mixer > h2 {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--muted);
      margin-bottom: 0.4rem;
    }

    .paint-subtitle {
      font-size: 0.75rem;
      color: var(--muted);
      margin-bottom: 1.25rem;
    }

    .brush-list {
      display: flex;
      flex-direction: column;
      gap: 0.85rem;
      margin-bottom: 1.4rem;
    }

    .brush-item {
      display: grid;
      grid-template-columns: 22px 58px 1fr 32px;
      align-items: center;
      gap: 0.75rem;
    }

    .brush-swatch {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .brush-label {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text);
    }

    .brush-slider {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 3px;
      outline: none;
      cursor: pointer;
      background: #333;
    }

    .brush-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid #555;
      cursor: pointer;
    }

    .brush-slider::-moz-range-thumb {
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid #555;
      cursor: pointer;
    }

    .brush-amount {
      font-size: 0.78rem;
      font-family: monospace;
      color: var(--muted);
      text-align: right;
    }

    .mix-result {
      display: flex;
      align-items: center;
      gap: 1.25rem;
      padding-top: 1.2rem;
      border-top: 1px solid var(--border);
    }

    .mix-preview {
      width: 88px;
      height: 64px;
      border-radius: 8px;
      border: 1px solid var(--border);
      flex-shrink: 0;
      background: #ffffff;
      transition: background 0.08s;
    }

    .mix-info {
      display: flex;
      flex-direction: column;
      gap: 0.55rem;
    }

    .mix-hex {
      font-family: monospace;
      font-size: 1rem;
      letter-spacing: 0.1em;
      color: var(--text);
    }

    .mix-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .mix-load-btn {
      background: #1a3a2a;
      border: 1px solid #2e6644;
      color: #5fcf8a;
      border-radius: 6px;
      padding: 0.38rem 0.9rem;
      font-size: 0.75rem;
      cursor: pointer;
      transition: background 0.15s;
    }

    .mix-load-btn:hover { background: #204a34; }

    .mix-reset-btn {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
      border-radius: 6px;
      padding: 0.38rem 0.9rem;
      font-size: 0.75rem;
      cursor: pointer;
      transition: background 0.15s;
    }

    .mix-reset-btn:hover { background: var(--surface2); }
  </style>
</head>
<body>

<header>
  <h1>RGB Color Studio</h1>
  <p>Mix · Explore · Build Palettes</p>
</header>

<div class="layout">

  <!-- Canvas Mixer -->
  <div class="canvas-mixer">
    <canvas id="paint-canvas" width="400" height="380"></canvas>
    <div class="canvas-controls">
      <div class="brush-indicator" id="brush-indicator"></div>
      <div class="brush-size-wrap">
        <span class="canvas-label">Size</span>
        <input type="range" id="brush-size" min="3" max="45" value="14">
        <span class="canvas-label" id="brush-size-val">14</span>
      </div>
      <button class="canvas-btn" id="clear-canvas-btn">Clear</button>
    </div>
  </div>

  <!-- Info panel -->
  <div class="info-panel">
    <div>
      <div class="panel-label">RGB</div>
      <div class="val-grid">
        <div class="val-box">
          <div class="lbl">Red</div>
          <div class="num" id="info-r">255</div>
        </div>
        <div class="val-box">
          <div class="lbl">Green</div>
          <div class="num" id="info-g">255</div>
        </div>
        <div class="val-box">
          <div class="lbl">Blue</div>
          <div class="num" id="info-b">255</div>
        </div>
        <div class="val-box" style="grid-column: 1 / -1">
          <div class="lbl">Hex — click to copy</div>
          <div class="num" id="info-hex">#ffffff</div>
        </div>
      </div>
    </div>

    <div>
      <div class="panel-label">HSL</div>
      <div class="val-grid">
        <div class="val-box">
          <div class="lbl">Hue</div>
          <div class="num" id="info-h">—</div>
        </div>
        <div class="val-box">
          <div class="lbl">Sat</div>
          <div class="num" id="info-s">—</div>
        </div>
        <div class="val-box">
          <div class="lbl">Light</div>
          <div class="num" id="info-l">—</div>
        </div>
      </div>
    </div>

    <div>
      <div class="panel-label">Luminance &amp; Contrast</div>
      <div class="val-grid">
        <div class="val-box" style="grid-column: 1 / -1; grid-template-columns: 1fr 1fr;">
          <div class="lbl">Relative Luminance</div>
          <div class="num" id="info-lum">—</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Contrast checker for active color -->
  <div class="contrast-section">
    <h2>Active Color — Contrast Check</h2>
    <div class="contrast-grid">
      <div class="contrast-card">
        <div class="contrast-demo" id="demo-white">
          <div class="demo-large">Aa</div>
          <div class="demo-small">The quick brown fox jumps.</div>
        </div>
        <div class="contrast-info">
          <span class="contrast-ratio" id="ratio-white">—</span>
          <span class="badge" id="badge-white-aa">AA</span>
          <span class="badge" id="badge-white-aaa">AAA</span>
          <span style="color:var(--muted);font-size:0.7rem;">on white</span>
        </div>
      </div>
      <div class="contrast-card">
        <div class="contrast-demo" id="demo-black">
          <div class="demo-large">Aa</div>
          <div class="demo-small">The quick brown fox jumps.</div>
        </div>
        <div class="contrast-info">
          <span class="contrast-ratio" id="ratio-black">—</span>
          <span class="badge" id="badge-black-aa">AA</span>
          <span class="badge" id="badge-black-aaa">AAA</span>
          <span style="color:var(--muted);font-size:0.7rem;">on black</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Palettes -->
  <div class="palettes">
    <h2>Generated Palettes — hover a swatch to preview, click to copy hex</h2>
    <div class="palette-grid">
      <div class="palette-section">
        <h3>Complementary</h3>
        <div class="swatches" id="pal-comp"></div>
      </div>
      <div class="palette-section">
        <h3>Analogous</h3>
        <div class="swatches" id="pal-analog"></div>
      </div>
      <div class="palette-section">
        <h3>Triadic</h3>
        <div class="swatches" id="pal-triadic"></div>
      </div>
      <div class="palette-section">
        <h3>Monochromatic</h3>
        <div class="swatches" id="pal-mono"></div>
      </div>
    </div>
  </div>

  <!-- Paint Brush Mixer -->
  <div class="paint-mixer">
    <h2>Paint Brush Mixer</h2>
    <p class="paint-subtitle">Dip each brush and blend — amounts mix like real pigment</p>
    <div class="brush-list">

      <div class="brush-item">
        <div class="brush-swatch" style="background:#ff3333"></div>
        <span class="brush-label">Red</span>
        <input type="range" class="brush-slider" id="brush-red" min="0" max="100" value="0">
        <span class="brush-amount" id="amt-red">0</span>
      </div>

      <div class="brush-item">
        <div class="brush-swatch" style="background:#22cc55"></div>
        <span class="brush-label">Green</span>
        <input type="range" class="brush-slider" id="brush-green" min="0" max="100" value="0">
        <span class="brush-amount" id="amt-green">0</span>
      </div>

      <div class="brush-item">
        <div class="brush-swatch" style="background:#3388ff"></div>
        <span class="brush-label">Blue</span>
        <input type="range" class="brush-slider" id="brush-blue" min="0" max="100" value="0">
        <span class="brush-amount" id="amt-blue">0</span>
      </div>

      <div class="brush-item">
        <div class="brush-swatch" style="background:#111111; border:1px solid #444"></div>
        <span class="brush-label">Black</span>
        <input type="range" class="brush-slider" id="brush-black" min="0" max="100" value="0">
        <span class="brush-amount" id="amt-black">0</span>
      </div>

      <div class="brush-item">
        <div class="brush-swatch" style="background:#ffffff; border:1px solid #444"></div>
        <span class="brush-label">White</span>
        <input type="range" class="brush-slider" id="brush-white" min="0" max="100" value="0">
        <span class="brush-amount" id="amt-white">0</span>
      </div>

    </div>
    <div class="mix-result">
      <div class="mix-preview" id="mix-preview"></div>
      <div class="mix-info">
        <span class="mix-hex" id="mix-hex">#ffffff</span>
        <div class="mix-buttons">
          <button class="mix-reset-btn" id="mix-reset-btn">Reset</button>
        </div>
      </div>
    </div>
  </div>

</div>

<div class="toast" id="toast">Copied!</div>

<script>
  // ── Color math ──────────────────────────────────────────────

  function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)); }

  function rgbToHex(r, g, b) {
    return '#' + [r, g, b].map(v => clamp(Math.round(v), 0, 255).toString(16).padStart(2, '0')).join('');
  }

  function hexToRgb(hex) {
    hex = hex.replace('#', '');
    if (hex.length === 3) hex = hex.split('').map(c => c + c).join('');
    const n = parseInt(hex, 16);
    return { r: (n >> 16) & 255, g: (n >> 8) & 255, b: n & 255 };
  }

  function rgbToHsl(r, g, b) {
    r /= 255; g /= 255; b /= 255;
    const max = Math.max(r, g, b), min = Math.min(r, g, b);
    let h, s;
    const l = (max + min) / 2;
    if (max === min) {
      h = s = 0;
    } else {
      const d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      switch (max) {
        case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
        case g: h = ((b - r) / d + 2) / 6; break;
        case b: h = ((r - g) / d + 4) / 6; break;
      }
    }
    return { h: Math.round(h * 360), s: Math.round(s * 100), l: Math.round(l * 100) };
  }

  function hslToRgb(h, s, l) {
    h /= 360; s /= 100; l /= 100;
    let r, g, b;
    if (s === 0) {
      r = g = b = l;
    } else {
      const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
      const p = 2 * l - q;
      const hue2rgb = (p, q, t) => {
        if (t < 0) t += 1; if (t > 1) t -= 1;
        if (t < 1/6) return p + (q - p) * 6 * t;
        if (t < 1/2) return q;
        if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
        return p;
      };
      r = hue2rgb(p, q, h + 1/3);
      g = hue2rgb(p, q, h);
      b = hue2rgb(p, q, h - 1/3);
    }
    return { r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255) };
  }

  function hslToHex(h, s, l) {
    s = clamp(s, 0, 100); l = clamp(l, 5, 95);
    const { r, g, b } = hslToRgb(h, s, l);
    return rgbToHex(r, g, b);
  }

  // ── WCAG contrast ───────────────────────────────────────────

  // Relative luminance per WCAG 2.1
  function relativeLuminance(r, g, b) {
    const lin = v => {
      v /= 255;
      return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
    };
    return 0.2126 * lin(r) + 0.7152 * lin(g) + 0.0722 * lin(b);
  }

  function contrastRatio(lum1, lum2) {
    const lighter = Math.max(lum1, lum2);
    const darker  = Math.min(lum1, lum2);
    return (lighter + 0.05) / (darker + 0.05);
  }

  // Returns { ratio, AA, AAA } where AA/AAA = true if passes normal text
  function wcag(r, g, b, bgR, bgG, bgB) {
    const fg = relativeLuminance(r, g, b);
    const bg = relativeLuminance(bgR, bgG, bgB);
    const ratio = contrastRatio(fg, bg);
    return {
      ratio: Math.round(ratio * 100) / 100,
      AA:  ratio >= 4.5,
      AAA: ratio >= 7.0,
    };
  }

  // ── Palette generation ──────────────────────────────────────

  function genPalettes(r, g, b) {
    const { h, s, l } = rgbToHsl(r, g, b);
    const base = rgbToHex(r, g, b);
    const comp = (h + 180) % 360;

    // Complementary: two shades of base + two of complement + comp itself
    const compPal = [
      hslToHex(h, s, clamp(l - 20, 5, 95)),
      base,
      hslToHex(h, s, clamp(l + 20, 5, 95)),
      hslToHex(comp, s, clamp(l + 15, 5, 95)),
      hslToHex(comp, s, l),
    ];

    // Analogous: ±60° and ±30°
    const analogPal = [
      hslToHex((h - 60 + 360) % 360, s, l),
      hslToHex((h - 30 + 360) % 360, s, l),
      base,
      hslToHex((h + 30) % 360, s, l),
      hslToHex((h + 60) % 360, s, l),
    ];

    // Triadic: base + 120° + 240°
    const t1 = (h + 120) % 360;
    const t2 = (h + 240) % 360;
    const triadicPal = [
      base,
      hslToHex(h,  s, clamp(l + 20, 5, 95)),
      hslToHex(t1, s, l),
      hslToHex(t2, s, l),
      hslToHex(t2, s, clamp(l + 20, 5, 95)),
    ];

    // Monochromatic: 5 lightness steps, keep hue & saturation
    const monoPal = [20, 35, 50, 65, 80].map(li => hslToHex(h, s, li));

    return { compPal, analogPal, triadicPal, monoPal };
  }

  // ── DOM helpers ─────────────────────────────────────────────

  function renderSwatches(containerId, hexes) {
    const el = document.getElementById(containerId);
    el.innerHTML = '';
    hexes.forEach(hex => {
      const { r, g, b } = hexToRgb(hex);
      const onWhite = wcag(r, g, b, 255, 255, 255);
      const onBlack = wcag(r, g, b,   0,   0,   0);

      // Pick best readable label color
      const lum = relativeLuminance(r, g, b);
      const textColor = lum > 0.35 ? '#000' : '#fff';

      const sw = document.createElement('div');
      sw.className = 'swatch';
      sw.style.background = hex;
      sw.title = `Click to copy ${hex}`;

      const info = document.createElement('div');
      info.className = 'swatch-info';

      const hexLabel = document.createElement('span');
      hexLabel.className = 'swatch-hex';
      hexLabel.textContent = hex;
      info.appendChild(hexLabel);

      // Mini contrast badges
      const badges = document.createElement('div');
      badges.className = 'swatch-badges';

      const mkBadge = (label, pass) => {
        const b = document.createElement('span');
        b.className = 'mini-badge ' + (pass ? 'pass' : 'fail');
        b.textContent = label;
        return b;
      };

      badges.appendChild(mkBadge('AA▪W',  onWhite.AA));
      badges.appendChild(mkBadge('AAA▪W', onWhite.AAA));
      badges.appendChild(mkBadge('AA▪B',  onBlack.AA));
      badges.appendChild(mkBadge('AAA▪B', onBlack.AAA));
      info.appendChild(badges);
      sw.appendChild(info);

      sw.addEventListener('click', () => copyHex(hex));
      el.appendChild(sw);
    });
  }

  // ── Contrast demo (active color) ───────────────────────────

  function updateContrastDemo(r, g, b, hex) {
    const onWhite = wcag(r, g, b, 255, 255, 255);
    const onBlack = wcag(r, g, b,   0,   0,   0);

    const demoWhite = document.getElementById('demo-white');
    demoWhite.style.background = '#fff';
    demoWhite.style.color = hex;

    const demoBlack = document.getElementById('demo-black');
    demoBlack.style.background = '#000';
    demoBlack.style.color = hex;

    const applyBadge = (id, pass) => {
      const el = document.getElementById(id);
      el.className = 'badge ' + (pass ? 'pass' : 'fail');
    };

    document.getElementById('ratio-white').textContent = onWhite.ratio + ':1';
    applyBadge('badge-white-aa',  onWhite.AA);
    applyBadge('badge-white-aaa', onWhite.AAA);

    document.getElementById('ratio-black').textContent = onBlack.ratio + ':1';
    applyBadge('badge-black-aa',  onBlack.AA);
    applyBadge('badge-black-aaa', onBlack.AAA);
  }

  // ── Main update ─────────────────────────────────────────────

  function update(r, g, b) {
    r = clamp(Math.round(r), 0, 255);
    g = clamp(Math.round(g), 0, 255);
    b = clamp(Math.round(b), 0, 255);

    const hex = rgbToHex(r, g, b);

    // Info panel
    document.getElementById('info-r').textContent = r;
    document.getElementById('info-g').textContent = g;
    document.getElementById('info-b').textContent = b;
    document.getElementById('info-hex').textContent = hex;

    const hsl = rgbToHsl(r, g, b);
    document.getElementById('info-h').textContent = hsl.h + '°';
    document.getElementById('info-s').textContent = hsl.s + '%';
    document.getElementById('info-l').textContent = hsl.l + '%';

    const lum = relativeLuminance(r, g, b);
    document.getElementById('info-lum').textContent = lum.toFixed(4);

    updateContrastDemo(r, g, b, hex);

    const { compPal, analogPal, triadicPal, monoPal } = genPalettes(r, g, b);
    renderSwatches('pal-comp',    compPal);
    renderSwatches('pal-analog',  analogPal);
    renderSwatches('pal-triadic', triadicPal);
    renderSwatches('pal-mono',    monoPal);
  }

  // ── Toast ───────────────────────────────────────────────────

  let toastTimer;
  function copyHex(hex) {
    navigator.clipboard.writeText(hex).then(() => {
      const t = document.getElementById('toast');
      t.textContent = 'Copied ' + hex;
      t.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => t.classList.remove('show'), 1800);
    });
  }

  document.getElementById('info-hex').addEventListener('click', () => {
    copyHex(document.getElementById('info-hex').textContent);
  });

  // ── Paint Canvas ─────────────────────────────────────────────

  const paintCanvas = document.getElementById('paint-canvas');
  const paintCtx = paintCanvas.getContext('2d');
  let isPainting = false;
  let lastPX = null, lastPY = null;

  function drawPaperTexture() {
    paintCtx.fillStyle = '#f0e8d8';
    paintCtx.fillRect(0, 0, paintCanvas.width, paintCanvas.height);
    const imgData = paintCtx.getImageData(0, 0, paintCanvas.width, paintCanvas.height);
    const d = imgData.data;
    for (let i = 0; i < d.length; i += 4) {
      const n = (Math.random() - 0.5) * 22;
      d[i]   = Math.max(0, Math.min(255, d[i]   + n));
      d[i+1] = Math.max(0, Math.min(255, d[i+1] + n));
      d[i+2] = Math.max(0, Math.min(255, d[i+2] + n));
    }
    paintCtx.putImageData(imgData, 0, 0);
  }

  function paintDot(x, y) {
    const { r, g, b } = mixPaints();
    const size = +document.getElementById('brush-size').value;
    const s = size * (0.82 + Math.random() * 0.36);
    const grad = paintCtx.createRadialGradient(x, y, 0, x, y, s);
    grad.addColorStop(0,    `rgba(${r},${g},${b},0.90)`);
    grad.addColorStop(0.42, `rgba(${r},${g},${b},0.55)`);
    grad.addColorStop(1,    `rgba(${r},${g},${b},0)`);
    paintCtx.fillStyle = grad;
    paintCtx.beginPath();
    paintCtx.arc(x, y, s, 0, Math.PI * 2);
    paintCtx.fill();
  }

  function paintStroke(x1, y1, x2, y2) {
    const size = +document.getElementById('brush-size').value;
    const dist = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
    const steps = Math.max(1, Math.ceil(dist / (size * 0.35)));
    for (let i = 0; i <= steps; i++) {
      const t = i / steps;
      paintDot(x1 + (x2 - x1) * t, y1 + (y2 - y1) * t);
    }
  }

  function getCanvasPos(e) {
    const rect = paintCanvas.getBoundingClientRect();
    const sx = paintCanvas.width / rect.width;
    const sy = paintCanvas.height / rect.height;
    const src = e.touches ? e.touches[0] : e;
    return { x: (src.clientX - rect.left) * sx, y: (src.clientY - rect.top) * sy };
  }

  paintCanvas.addEventListener('mousedown', e => {
    isPainting = true;
    const { x, y } = getCanvasPos(e);
    lastPX = x; lastPY = y;
    paintDot(x, y);
  });

  paintCanvas.addEventListener('mousemove', e => {
    if (!isPainting) return;
    const { x, y } = getCanvasPos(e);
    paintStroke(lastPX, lastPY, x, y);
    lastPX = x; lastPY = y;
  });

  paintCanvas.addEventListener('mouseup',    () => { isPainting = false; });
  paintCanvas.addEventListener('mouseleave', () => { isPainting = false; });

  paintCanvas.addEventListener('touchstart', e => {
    e.preventDefault();
    isPainting = true;
    const { x, y } = getCanvasPos(e);
    lastPX = x; lastPY = y;
    paintDot(x, y);
  }, { passive: false });

  paintCanvas.addEventListener('touchmove', e => {
    e.preventDefault();
    if (!isPainting) return;
    const { x, y } = getCanvasPos(e);
    paintStroke(lastPX, lastPY, x, y);
    lastPX = x; lastPY = y;
  }, { passive: false });

  paintCanvas.addEventListener('touchend', () => { isPainting = false; });

  document.getElementById('brush-size').addEventListener('input', function () {
    document.getElementById('brush-size-val').textContent = this.value;
  });

  document.getElementById('clear-canvas-btn').addEventListener('click', drawPaperTexture);

  // ── Paint Brush Mixer ───────────────────────────────────────

  const brushDefs = [
    { id: 'red',   rgb: [255, 0,   0  ], trackColor: '#ff3333' },
    { id: 'green', rgb: [0,   255, 0  ], trackColor: '#22cc55' },
    { id: 'blue',  rgb: [0,   0,   255], trackColor: '#3388ff' },
    { id: 'black', rgb: [0,   0,   0  ], trackColor: '#666666' },
    { id: 'white', rgb: [255, 255, 255], trackColor: '#bbbbbb' },
  ];

  function mixPaints() {
    let total = 0, r = 0, g = 0, b = 0;
    brushDefs.forEach(brush => {
      const amt = +document.getElementById('brush-' + brush.id).value;
      total += amt;
      r += brush.rgb[0] * amt;
      g += brush.rgb[1] * amt;
      b += brush.rgb[2] * amt;
    });
    if (total === 0) return { r: 255, g: 255, b: 255 };
    return {
      r: Math.round(r / total),
      g: Math.round(g / total),
      b: Math.round(b / total),
    };
  }

  function updatePaintMixer() {
    brushDefs.forEach(brush => {
      const slider = document.getElementById('brush-' + brush.id);
      const amt = +slider.value;
      document.getElementById('amt-' + brush.id).textContent = amt;
      slider.style.background =
        `linear-gradient(to right, ${brush.trackColor} 0%, ${brush.trackColor} ${amt}%, #333 ${amt}%, #333 100%)`;
    });
    const { r, g, b } = mixPaints();
    const hex = rgbToHex(r, g, b);
    document.getElementById('mix-preview').style.background = hex;
    document.getElementById('mix-hex').textContent = hex;
    document.getElementById('brush-indicator').style.background = hex;
    update(r, g, b);
  }

  brushDefs.forEach(brush => {
    document.getElementById('brush-' + brush.id).addEventListener('input', updatePaintMixer);
  });

  document.getElementById('mix-reset-btn').addEventListener('click', () => {
    brushDefs.forEach(brush => {
      const slider = document.getElementById('brush-' + brush.id);
      slider.value = 0;
      slider.style.background = '#333';
      document.getElementById('amt-' + brush.id).textContent = '0';
    });
    document.getElementById('mix-preview').style.background = '#ffffff';
    document.getElementById('mix-hex').textContent = '#ffffff';
    document.getElementById('brush-indicator').style.background = '#ffffff';
    update(255, 255, 255);
  });

  // ── Init ────────────────────────────────────────────────────
  drawPaperTexture();
  updatePaintMixer();
</script>
</body>
</html>
