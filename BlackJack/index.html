<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BlackJack Casino</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Georgia', serif;
      background: radial-gradient(ellipse at center, #1a5c2a 0%, #0a2610 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #fff;
      user-select: none;
    }

    /* ── Header ── */
    header {
      width: 100%;
      max-width: 860px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 28px;
      border-bottom: 2px solid #c9a228;
    }
    header h1 {
      font-size: 1.9rem;
      color: #ffd700;
      text-shadow: 0 0 14px rgba(255,215,0,0.45);
      letter-spacing: 4px;
      text-transform: uppercase;
    }
    #balance-display {
      font-size: 1.1rem;
      color: #ffd700;
      background: rgba(0,0,0,0.45);
      padding: 7px 18px;
      border-radius: 20px;
      border: 1px solid #c9a228;
      letter-spacing: 1px;
    }

    /* ── Table ── */
    #table {
      width: calc(100% - 32px);
      max-width: 820px;
      min-height: 360px;
      margin: 22px auto 0;
      background: #1b6b2a;
      border-radius: 200px / 100px;
      border: 12px solid #4e342e;
      box-shadow: inset 0 0 60px rgba(0,0,0,0.45), 0 12px 40px rgba(0,0,0,0.65);
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      padding: 28px 60px;
      overflow: hidden;
    }
    /* subtle felt grain */
    #table::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4'%3E%3Ccircle cx='1' cy='1' r='0.5' fill='rgba(0,0,0,0.07)'/%3E%3C/svg%3E");
      pointer-events: none;
    }

    .area-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: rgba(255,255,255,0.55);
      text-align: center;
      margin: 4px 0;
      position: relative;
      z-index: 1;
    }
    .score-badge {
      display: none;
      background: rgba(0,0,0,0.55);
      color: #ffd700;
      border: 1px solid #c9a228;
      border-radius: 10px;
      padding: 1px 9px;
      font-size: 0.88rem;
      margin-left: 7px;
      vertical-align: middle;
    }
    .score-badge.bust { color: #ef5350; border-color: #ef5350; }

    /* ── Hands ── */
    .hand {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 8px;
      min-height: 115px;
      position: relative;
      z-index: 1;
    }

    /* ── Cards ── */
    .card {
      width: 72px;
      height: 108px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 2px 3px 10px rgba(0,0,0,0.45);
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 5px;
      animation: deal 0.28s ease-out;
      flex-shrink: 0;
    }
    @keyframes deal {
      from { transform: scale(0.4) translateY(-30px); opacity: 0; }
      to   { transform: scale(1)   translateY(0);     opacity: 1; }
    }
    .card.red   { color: #c62828; }
    .card.black { color: #1a1a1a; }

    .corner {
      display: flex;
      flex-direction: column;
      align-items: center;
      line-height: 1.1;
    }
    .corner.br { align-self: flex-end; transform: rotate(180deg); }
    .corner .rank { font-size: 14px; font-weight: bold; }
    .corner .suit { font-size: 11px; }
    .card-pip {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 28px;
      line-height: 1;
    }

    /* Face-down card back */
    .card.face-down {
      background: #1565c0;
      background-image:
        repeating-linear-gradient( 45deg, rgba(255,255,255,0.07) 0, rgba(255,255,255,0.07) 2px, transparent 2px, transparent 12px),
        repeating-linear-gradient(-45deg, rgba(255,255,255,0.07) 0, rgba(255,255,255,0.07) 2px, transparent 2px, transparent 12px);
      border: 3px solid rgba(255,255,255,0.18);
    }
    .card.face-down::after {
      content: '';
      position: absolute;
      inset: 6px;
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 4px;
    }

    /* ── Table centre decoration ── */
    .table-centre {
      text-align: center;
      position: relative;
      z-index: 1;
      width: 100%;
    }
    .table-rule {
      width: 78%;
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(255,255,255,0.18), transparent);
      margin: 3px auto;
    }
    .table-text {
      font-size: 0.68rem;
      color: rgba(255,255,255,0.28);
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    /* ── Result message ── */
    #message-area {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      background: rgba(0,0,0,0.78);
      border: 2px solid #c9a228;
      border-radius: 14px;
      padding: 14px 28px;
      z-index: 20;
      pointer-events: none;
      animation: popIn 0.25s ease-out;
      min-width: 200px;
    }
    @keyframes popIn {
      from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
      to   { transform: translate(-50%, -50%) scale(1);   opacity: 1; }
    }
    #message-text {
      font-size: 1.55rem;
      font-weight: bold;
      color: #ffd700;
      text-shadow: 0 0 12px rgba(255,215,0,0.5);
    }
    #message-sub {
      font-size: 0.95rem;
      color: rgba(255,255,255,0.85);
      margin-top: 5px;
    }

    /* ── Controls ── */
    #controls {
      width: 100%;
      max-width: 860px;
      padding: 14px 24px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    /* Bet display */
    #bet-display {
      font-size: 1rem;
      color: #ffd700;
      background: rgba(0,0,0,0.4);
      padding: 5px 18px;
      border-radius: 16px;
      border: 1px solid #c9a228;
      letter-spacing: 1px;
    }

    /* ── Chips ── */
    #chips { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }

    .chip {
      width: 66px; height: 66px;
      border-radius: 50%;
      border: none;
      outline: 4px dashed rgba(255,255,255,0.35);
      outline-offset: -5px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      font-weight: bold;
      font-size: 0.82rem;
      cursor: pointer;
      color: #fff;
      text-shadow: 0 1px 3px rgba(0,0,0,0.7);
      font-family: 'Georgia', serif;
      transition: transform 0.13s, box-shadow 0.13s, opacity 0.13s;
      position: relative;
    }
    .chip::after {
      content: '';
      position: absolute;
      inset: 5px;
      border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .chip:hover:not(:disabled) { transform: translateY(-5px) scale(1.06); box-shadow: 0 8px 20px rgba(0,0,0,0.5); }
    .chip:active:not(:disabled) { transform: translateY(-2px) scale(1.02); }
    .chip:disabled { opacity: 0.35; cursor: not-allowed; }

    .chip-5   { background: radial-gradient(circle at 35% 35%, #ef5350, #b71c1c); }
    .chip-25  { background: radial-gradient(circle at 35% 35%, #66bb6a, #2e7d32); }
    .chip-100 { background: radial-gradient(circle at 35% 35%, #42a5f5, #1565c0); }
    .chip-500 { background: radial-gradient(circle at 35% 35%, #8d6e63, #3e2723); }

    /* ── Buttons ── */
    .btn {
      padding: 10px 22px;
      border: 2px solid #c9a228;
      background: rgba(0,0,0,0.5);
      color: #ffd700;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Georgia', serif;
      font-size: 0.93rem;
      font-weight: bold;
      letter-spacing: 1px;
      text-transform: uppercase;
      transition: background 0.18s, transform 0.13s, box-shadow 0.13s;
    }
    .btn:hover:not(:disabled) {
      background: rgba(201,162,40,0.22);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .btn:active:not(:disabled) { transform: translateY(0); }
    .btn:disabled { opacity: 0.38; cursor: not-allowed; }

    .btn.primary {
      background: linear-gradient(135deg, #b8860b, #ffd700);
      color: #1a1000;
      border-color: #ffd700;
    }
    .btn.primary:hover:not(:disabled) {
      background: linear-gradient(135deg, #d4a017, #ffe066);
    }
    .btn.danger { border-color: #ef5350; color: #ef5350; }
    .btn.danger:hover:not(:disabled) { background: rgba(239,83,80,0.18); }

    /* ── Control panels ── */
    #betting-controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    #bet-row { display: flex; gap: 10px; }

    #action-buttons { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }

    #insurance-prompt {
      background: rgba(0,0,0,0.72);
      border: 2px solid #ffd700;
      border-radius: 14px;
      padding: 16px 26px;
      text-align: center;
      animation: popIn 0.25s ease-out;
    }
    #insurance-prompt p { margin-bottom: 6px; font-size: 1rem; }
    #insurance-prompt .ins-btns { display: flex; gap: 10px; justify-content: center; margin-top: 10px; }

    .hidden { display: none !important; }

    /* ── Insurance indicator ── */
    #insurance-indicator {
      font-size: 0.82rem;
      color: rgba(255,215,0,0.75);
      letter-spacing: 1px;
    }

    /* ── Responsive ── */
    @media (max-width: 580px) {
      #table { border-radius: 60px; padding: 20px 20px; border-width: 8px; }
      header h1 { font-size: 1.35rem; letter-spacing: 2px; }
      .card { width: 58px; height: 87px; }
      .card-pip { font-size: 22px; }
      .corner .rank { font-size: 12px; }
      .chip { width: 56px; height: 56px; font-size: 0.75rem; }
    }
  </style>
</head>
<body>

<header>
  <h1>♠ BlackJack ♠</h1>
  <div id="balance-display">Balance: $<span id="balance">1000</span></div>
</header>

<div id="table">
  <!-- Dealer -->
  <div id="dealer-area">
    <div class="area-label">
      Dealer <span id="dealer-score" class="score-badge"></span>
    </div>
    <div id="dealer-hand" class="hand"></div>
  </div>

  <!-- Centre decoration -->
  <div class="table-centre">
    <div class="table-rule"></div>
    <div class="table-text">Blackjack Pays 3 to 2 &nbsp;·&nbsp; Dealer Stands on 17</div>
    <div class="table-rule"></div>
  </div>

  <!-- Result overlay -->
  <div id="message-area" class="hidden">
    <div id="message-text"></div>
    <div id="message-sub"></div>
  </div>

  <!-- Player -->
  <div id="player-area">
    <div id="player-hand" class="hand"></div>
    <div class="area-label">
      You <span id="player-score" class="score-badge"></span>
    </div>
  </div>
</div>

<!-- Controls -->
<div id="controls">

  <!-- Betting panel -->
  <div id="betting-controls">
    <div id="bet-display">Bet: $<span id="current-bet">0</span></div>
    <div id="chips">
      <button class="chip chip-5"   onclick="placeBet(5)"  >$5</button>
      <button class="chip chip-25"  onclick="placeBet(25)" >$25</button>
      <button class="chip chip-100" onclick="placeBet(100)">$100</button>
      <button class="chip chip-500" onclick="placeBet(500)">$500</button>
    </div>
    <div id="bet-row">
      <button class="btn danger" onclick="clearBet()">Clear</button>
      <button class="btn primary" id="deal-btn" onclick="startGame()" disabled>Deal</button>
    </div>
  </div>

  <!-- Insurance panel -->
  <div id="insurance-prompt" class="hidden">
    <p>Dealer shows an <strong style="color:#ffd700">Ace</strong> — Take Insurance?</p>
    <p style="color:rgba(255,255,255,0.7)">Side bet: $<span id="insurance-amount">0</span> &nbsp;·&nbsp; Pays 2 to 1 if dealer has Blackjack</p>
    <div class="ins-btns">
      <button class="btn primary" onclick="takeInsurance()">Take Insurance</button>
      <button class="btn"         onclick="declineInsurance()">No Thanks</button>
    </div>
  </div>

  <!-- Player action buttons -->
  <div id="action-buttons" class="hidden">
    <div id="insurance-indicator" class="hidden">Insurance: $<span id="ins-indicator-val">0</span></div>
    <button class="btn"         id="hit-btn"    onclick="hit()">Hit</button>
    <button class="btn"         id="stand-btn"  onclick="stand()">Stand</button>
    <button class="btn primary" id="double-btn" onclick="doubleDown()">Double Down</button>
  </div>

  <!-- Next round -->
  <button class="btn primary hidden" id="new-round-btn" onclick="newRound()">Next Round</button>

</div>

<script>
// ─────────────────────────────────────────────
//  CONSTANTS & STATE
// ─────────────────────────────────────────────
const SUITS = ['♠','♥','♦','♣'];
const RANKS = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
const RED   = ['♥','♦'];

let deck        = [];
let playerHand  = [];
let dealerHand  = [];
let balance     = 1000;
let currentBet  = 0;
let insuranceBet= 0;
let phase       = 'betting'; // betting | insurance | playerTurn | dealerTurn | gameOver
let firstAction = true;      // used to gate double-down availability

// ─────────────────────────────────────────────
//  DECK
// ─────────────────────────────────────────────
function buildDeck() {
  const d = [];
  for (const s of SUITS) for (const r of RANKS) d.push({ suit: s, rank: r });
  return d;
}
function shuffle(d) {
  for (let i = d.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [d[i], d[j]] = [d[j], d[i]];
  }
  return d;
}
function draw(hidden = false) {
  if (deck.length < 15) deck = shuffle(buildDeck());
  const c = deck.pop();
  c.hidden = hidden;
  return c;
}

// ─────────────────────────────────────────────
//  HAND MATH
// ─────────────────────────────────────────────
function rankValue(r) {
  if (r === 'A') return 11;
  if (['J','Q','K'].includes(r)) return 10;
  return parseInt(r);
}
function handTotal(hand) {
  let total = 0, aces = 0;
  for (const c of hand) {
    if (c.hidden) continue;
    total += rankValue(c.rank);
    if (c.rank === 'A') aces++;
  }
  while (total > 21 && aces > 0) { total -= 10; aces--; }
  return total;
}
function isBJ(hand)   { return hand.length === 2 && handTotal(hand) === 21; }
function isBust(hand) { return handTotal(hand) > 21; }

// ─────────────────────────────────────────────
//  RENDERING
// ─────────────────────────────────────────────
function makeCard(card) {
  const el = document.createElement('div');
  if (card.hidden) {
    el.className = 'card face-down';
    return el;
  }
  el.className = 'card ' + (RED.includes(card.suit) ? 'red' : 'black');
  el.innerHTML = `
    <div class="corner">
      <span class="rank">${card.rank}</span>
      <span class="suit">${card.suit}</span>
    </div>
    <div class="card-pip">${card.suit}</div>
    <div class="corner br">
      <span class="rank">${card.rank}</span>
      <span class="suit">${card.suit}</span>
    </div>`;
  return el;
}

function renderHands() {
  const ph = document.getElementById('player-hand');
  const dh = document.getElementById('dealer-hand');
  ph.innerHTML = '';
  dh.innerHTML = '';
  playerHand.forEach(c => ph.appendChild(makeCard(c)));
  dealerHand.forEach(c => dh.appendChild(makeCard(c)));
}

function updateScores() {
  const ps = document.getElementById('player-score');
  const ds = document.getElementById('dealer-score');

  if (playerHand.length) {
    const v = handTotal(playerHand);
    ps.textContent = v;
    ps.style.display = 'inline-block';
    ps.className = 'score-badge' + (v > 21 ? ' bust' : '');
  } else {
    ps.style.display = 'none';
  }

  const visible = dealerHand.filter(c => !c.hidden);
  if (visible.length) {
    const v = handTotal(visible);
    ds.textContent = v;
    ds.style.display = 'inline-block';
    ds.className = 'score-badge' + (v > 21 ? ' bust' : '');
  } else {
    ds.style.display = 'none';
  }
}

function setMessage(text, sub = '') {
  document.getElementById('message-text').textContent = text;
  document.getElementById('message-sub').textContent  = sub;
  document.getElementById('message-area').classList.remove('hidden');
}
function clearMessage() {
  document.getElementById('message-area').classList.add('hidden');
}

function showPanel(name) {
  // Hide all panels
  ['betting-controls','insurance-prompt','action-buttons','new-round-btn'].forEach(id => {
    document.getElementById(id).classList.add('hidden');
  });
  if (name) document.getElementById(name).classList.remove('hidden');
}

function refreshChips() {
  document.querySelectorAll('.chip').forEach(btn => {
    const amt = parseInt(btn.textContent.replace('$',''));
    btn.disabled = (currentBet + amt > balance);
  });
  document.getElementById('deal-btn').disabled = (currentBet === 0);
}

function updateBalanceDisplay() {
  document.getElementById('balance').textContent = balance.toLocaleString();
}
function updateBetDisplay() {
  document.getElementById('current-bet').textContent = currentBet.toLocaleString();
}

// ─────────────────────────────────────────────
//  BETTING
// ─────────────────────────────────────────────
function placeBet(amt) {
  if (phase !== 'betting') return;
  if (currentBet + amt > balance) return;
  currentBet += amt;
  updateBetDisplay();
  refreshChips();
}
function clearBet() {
  if (phase !== 'betting') return;
  currentBet = 0;
  updateBetDisplay();
  refreshChips();
}

// ─────────────────────────────────────────────
//  START GAME
// ─────────────────────────────────────────────
function startGame() {
  if (currentBet === 0 || currentBet > balance) return;

  phase       = 'playerTurn';
  firstAction = true;
  insuranceBet = 0;
  clearMessage();

  // Deduct bet
  balance -= currentBet;
  updateBalanceDisplay();

  // Deal
  playerHand = [draw(), draw()];
  dealerHand = [draw(), draw(true)];   // second card face-down

  renderHands();
  updateScores();

  // Dealer shows Ace → offer insurance first
  if (dealerHand[0].rank === 'A') {
    phase = 'insurance';
    const insAmt = Math.floor(currentBet / 2);
    document.getElementById('insurance-amount').textContent = insAmt;
    showPanel('insurance-prompt');
    return;
  }

  // No insurance — check for player BJ
  if (isBJ(playerHand)) {
    revealHole();
    if (isBJ(dealerHand)) {
      endRound('push', 'Both Blackjack!', 'Push — bet returned');
    } else {
      endRound('blackjack', 'Blackjack!', `+$${Math.floor(currentBet * 1.5)} (3:2 payout)`);
    }
    return;
  }

  enterPlayerTurn();
}

// ─────────────────────────────────────────────
//  INSURANCE
// ─────────────────────────────────────────────
function takeInsurance() {
  const insAmt = Math.floor(currentBet / 2);
  if (balance < insAmt) { declineInsurance(); return; }
  insuranceBet = insAmt;
  balance -= insuranceBet;
  updateBalanceDisplay();
  resolveInsurance();
}
function declineInsurance() {
  insuranceBet = 0;
  resolveInsurance();
}
function resolveInsurance() {
  revealHole();
  renderHands();
  updateScores();

  if (isBJ(dealerHand)) {
    // Dealer has BJ
    if (insuranceBet > 0) {
      balance += insuranceBet * 3;  // return stake + 2:1 profit
      updateBalanceDisplay();
    }
    if (isBJ(playerHand)) {
      const insNote = insuranceBet > 0 ? ` · Insurance +$${insuranceBet * 2}` : '';
      endRound('push', 'Both Blackjack!', 'Push — bet returned' + insNote);
    } else {
      const insNote = insuranceBet > 0 ? `Insurance paid +$${insuranceBet * 2}` : 'No insurance taken';
      endRound('lose', 'Dealer has Blackjack!', insNote);
    }
    return;
  }

  // Dealer does NOT have BJ — hide hole again, continue
  dealerHand[1].hidden = true;
  renderHands();
  updateScores();

  if (insuranceBet > 0) {
    // Insurance lost silently (already deducted)
    // Brief flash so player knows
    setMessage('Insurance lost', '');
    setTimeout(() => {
      clearMessage();
      if (isBJ(playerHand)) {
        revealHole();
        endRound('blackjack', 'Blackjack!', `+$${Math.floor(currentBet * 1.5)} (3:2 payout)`);
      } else {
        enterPlayerTurn();
      }
    }, 900);
    return;
  }

  if (isBJ(playerHand)) {
    revealHole();
    endRound('blackjack', 'Blackjack!', `+$${Math.floor(currentBet * 1.5)} (3:2 payout)`);
    return;
  }

  enterPlayerTurn();
}

function revealHole() {
  dealerHand[1].hidden = false;
}

// ─────────────────────────────────────────────
//  PLAYER TURN
// ─────────────────────────────────────────────
function enterPlayerTurn() {
  phase = 'playerTurn';
  firstAction = true;

  // Show insurance indicator if applicable
  const indic = document.getElementById('insurance-indicator');
  if (insuranceBet > 0) {
    document.getElementById('ins-indicator-val').textContent = insuranceBet;
    indic.classList.remove('hidden');
  } else {
    indic.classList.add('hidden');
  }

  refreshDoubleBtn();
  showPanel('action-buttons');
}

function refreshDoubleBtn() {
  const canDouble = firstAction && balance >= currentBet;
  document.getElementById('double-btn').disabled = !canDouble;
}

function hit() {
  if (phase !== 'playerTurn') return;
  firstAction = false;
  playerHand.push(draw());
  renderHands();
  updateScores();
  refreshDoubleBtn();

  if (isBust(playerHand)) {
    revealHole();
    renderHands();
    updateScores();
    endRound('lose', 'Bust!', `-$${currentBet}`);
  } else if (handTotal(playerHand) === 21) {
    stand(); // auto-stand on 21
  }
}

function stand() {
  if (phase !== 'playerTurn') return;
  phase = 'dealerTurn';
  showPanel(null);
  revealHole();
  renderHands();
  updateScores();
  dealerLoop();
}

function doubleDown() {
  if (phase !== 'playerTurn' || !firstAction || balance < currentBet) return;
  balance    -= currentBet;
  currentBet *= 2;
  updateBalanceDisplay();

  playerHand.push(draw());
  renderHands();
  updateScores();

  if (isBust(playerHand)) {
    revealHole();
    renderHands();
    updateScores();
    endRound('lose', 'Bust after Double Down!', `-$${currentBet}`);
  } else {
    stand();
  }
}

// ─────────────────────────────────────────────
//  DEALER TURN
// ─────────────────────────────────────────────
function dealerLoop() {
  const total = handTotal(dealerHand);
  if (total < 17) {
    setTimeout(() => {
      dealerHand.push(draw());
      renderHands();
      updateScores();
      dealerLoop();
    }, 480);
  } else {
    setTimeout(evaluateResult, 360);
  }
}

// ─────────────────────────────────────────────
//  RESULT
// ─────────────────────────────────────────────
function evaluateResult() {
  const pt = handTotal(playerHand);
  const dt = handTotal(dealerHand);

  if (isBust(dealerHand)) {
    endRound('win', `Dealer busts with ${dt}!`, `You win +$${currentBet}`);
  } else if (pt > dt) {
    endRound('win', `You win! ${pt} vs ${dt}`, `+$${currentBet}`);
  } else if (pt < dt) {
    endRound('lose', `Dealer wins. ${dt} vs ${pt}`, `-$${currentBet}`);
  } else {
    endRound('push', `Push! Both have ${pt}`, 'Bet returned');
  }
}

function endRound(result, msg, sub = '') {
  phase = 'gameOver';

  if (result === 'blackjack') {
    balance += currentBet + Math.floor(currentBet * 1.5);
  } else if (result === 'win') {
    balance += currentBet * 2;
  } else if (result === 'push') {
    balance += currentBet;
  }
  // 'lose' → nothing added

  updateBalanceDisplay();
  setMessage(msg, sub);
  showPanel('new-round-btn');

  if (balance === 0) {
    setTimeout(() => {
      setMessage('Out of chips!', 'Click below to reload $1,000');
      document.getElementById('new-round-btn').textContent = 'Reload Chips ($1,000)';
    }, 600);
  }
}

// ─────────────────────────────────────────────
//  NEW ROUND
// ─────────────────────────────────────────────
function newRound() {
  if (balance === 0) {
    balance = 1000;
    updateBalanceDisplay();
  }

  currentBet   = 0;
  insuranceBet = 0;
  playerHand   = [];
  dealerHand   = [];
  phase        = 'betting';

  document.getElementById('player-hand').innerHTML = '';
  document.getElementById('dealer-hand').innerHTML = '';
  document.getElementById('player-score').style.display = 'none';
  document.getElementById('dealer-score').style.display = 'none';
  document.getElementById('new-round-btn').textContent = 'Next Round';

  updateBetDisplay();
  updateBalanceDisplay();
  clearMessage();
  showPanel('betting-controls');
  refreshChips();
}

// ─────────────────────────────────────────────
//  INIT
// ─────────────────────────────────────────────
deck = shuffle(buildDeck());
newRound();
</script>
</body>
</html>
